<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:MD_Viewer.ViewModels"
             xmlns:models="clr-namespace:MD_Viewer.Models;assembly=MD_Viewer.Shared"
             xmlns:views="clr-namespace:MD_Viewer.Views"
             x:Class="MD_Viewer.Views.FileTreeView"
             x:DataType="viewmodels:FileTreeViewModel">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 磁碟選擇器 -->
        <Picker Grid.Row="0"
                ItemsSource="{Binding Drives}"
                SelectedItem="{Binding SelectedDrive}"
                ItemDisplayBinding="{Binding Name}"
                Margin="8"
                Title="選擇磁碟" />

        <!-- 檔案樹 -->
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding FileTree}"
                        SelectionMode="Single"
                        SelectedItem="{Binding SelectedNode}">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:FileNode">
                    <views:TreeViewItem BindingContext="{Binding .}" />
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- 載入狀態指示器 -->
        <ActivityIndicator Grid.Row="2"
                           IsRunning="{Binding IsLoading}"
                           IsVisible="{Binding IsLoading}"
                           HeightRequest="30"
                           Margin="8" />

        <!-- 錯誤訊息 -->
        <Label Grid.Row="2"
               Text="{Binding ErrorMessage}"
               TextColor="Red"
               FontSize="12"
               Margin="8"
               HorizontalOptions="Start"
               VerticalOptions="Center">
            <Label.Triggers>
                <DataTrigger TargetType="Label" Binding="{Binding ErrorMessage, TargetNullValue=''}" Value="">
                    <Setter Property="IsVisible" Value="False" />
                </DataTrigger>
            </Label.Triggers>
        </Label>
    </Grid>

</ContentView>

