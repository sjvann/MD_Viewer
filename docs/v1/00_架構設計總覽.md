# 架構設計總覽

## 文件索引

本目錄包含完整的架構設計文件，請依以下順序閱讀：

1. **[01_系統架構設計.md](./01_系統架構設計.md)** - 整體系統架構、模組劃分、資料流設計
2. **[02_介面與類別設計.md](./02_介面與類別設計.md)** - 核心介面定義、資料模型、服務實作
3. **[03_MVVM結構設計.md](./03_MVVM結構設計.md)** - MVVM 模式實作、ViewModel 設計、資料綁定
4. **[04_平台抽象層設計.md](./04_平台抽象層設計.md)** - 平台特定實作、跨平台抽象
5. **[05_專案結構與命名規範.md](./05_專案結構與命名規範.md)** - 專案組織、命名規範、程式碼規範

## 架構設計原則

### 1. 分層架構
- **Presentation Layer**：Views (XAML) 和 ViewModels
- **Business Logic Layer**：Services 和業務邏輯
- **Platform Abstraction Layer**：平台特定實作
- **Data Layer**：Models 和資料存取

### 2. 依賴注入
- 所有服務透過 DI 容器註冊
- ViewModel 透過建構函式注入依賴
- 便於測試和維護

### 3. MVVM 模式
- View 僅負責 UI 呈現
- ViewModel 包含 UI 邏輯和狀態
- Model 包含資料和業務邏輯

### 4. 平台抽象
- 使用介面定義平台特定功能
- 透過條件編譯實作平台特定程式碼
- 上層服務不依賴特定平台

### 5. 非同步優先
- 所有 I/O 操作使用 async/await
- 避免阻塞 UI 執行緒
- 提供取消令牌支援

## 核心模組

### 檔案系統模組
- **介面**：`IFileSystemService`
- **實作**：`FileSystemService`
- **平台抽象**：`IPlatformFileSystem`
- **功能**：跨平台檔案操作、目錄讀取、檔案過濾

### Markdown 處理模組
- **介面**：`IMarkdownService`
- **實作**：`MarkdownService` (C#) + TypeScript Renderer
- **功能**：Markdown 解析、HTML 渲染、語法高亮、數學公式

### 匯出模組
- **介面**：`IExportService`
- **實作**：`ExportService` + 各格式 Exporter
- **功能**：HTML、PDF、DOCX、ODF 匯出

### UI 模組
- **Views**：MAUI XAML Views
- **ViewModels**：MVVM ViewModels
- **Blazor Components**：WebView 中的預覽和編輯元件

## 技術決策

### UI 框架
✅ **採用混合方案**：
- 主要 UI 使用 MAUI 原生 (XAML)
- Markdown 渲染使用 Blazor WebView + TypeScript

### Markdown 處理
✅ **雙端處理**：
- C# 端：Markdig（解析和驗證）
- TypeScript 端：marked.js（渲染和語法高亮）

### 匯出格式
✅ **優先順序**：
1. HTML（最簡單，優先實作）
2. PDF（QuestPDF）
3. DOCX（DocumentFormat.OpenXml）
4. ODF（自行實作）

### 平台支援
✅ **階段性實作**：
1. Phase 1：Windows（MVP）
2. Phase 2：macOS
3. Phase 3：Android

## 依賴關係圖

```
MainViewModel
    ├── IFileSystemService
    │       └── IPlatformFileSystem
    │               ├── WindowsFileSystem
    │               ├── MacFileSystem
    │               └── AndroidFileSystem
    │
    ├── IMarkdownService
    │       └── MarkdownService
    │
    ├── IExportService
    │       ├── HtmlExporter
    │       ├── PdfExporter
    │       ├── DocxExporter
    │       └── OdfExporter
    │
    └── FileTreeViewModel
            └── IFileSystemService
```

## 資料流

### 檔案選擇流程
```
User → FileTreeView → FileTreeViewModel → IFileSystemService 
→ PlatformFileSystem → File System → Content → MainViewModel 
→ PreviewViewModel → Blazor WebView → TypeScript Renderer → Display
```

### 編輯流程
```
User → Editor (Blazor) → JavaScript Interop → MainViewModel 
→ PreviewViewModel → Blazor WebView → Display
```

### 匯出流程
```
User → ExportDialog → MainViewModel → IExportService 
→ Format Exporter → IMarkdownService → File System
```

## 下一步

完成架構設計後，建議進行：

1. **專案規劃**：制定詳細的開發計畫和時程
2. **專案初始化**：建立專案結構和基礎設定
3. **核心功能開發**：依優先順序實作各模組

## 參考文件

- [技術分析報告](../技術分析報告.md) - Analyst 提供的技術分析
- [.NET MAUI 官方文件](https://learn.microsoft.com/dotnet/maui/)
- [CommunityToolkit.Mvvm 文件](https://learn.microsoft.com/dotnet/communitytoolkit/mvvm/)

