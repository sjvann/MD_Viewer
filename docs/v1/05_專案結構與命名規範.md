# 專案結構與命名規範

## 1. 解決方案結構

```
MD_Viewer/
├── MD_Viewer/                          # 主應用程式專案
│   ├── Platforms/                      # 平台特定實作
│   │   ├── Windows/
│   │   │   ├── WindowsFileSystem.cs
│   │   │   └── WindowsPlatformInitializer.cs
│   │   ├── MacCatalyst/
│   │   │   ├── MacFileSystem.cs
│   │   │   └── MacPlatformInitializer.cs
│   │   └── Android/
│   │       ├── AndroidFileSystem.cs
│   │       ├── AndroidPlatformInitializer.cs
│   │       └── MainActivity.cs
│   │
│   ├── Views/                          # MAUI Views (XAML)
│   │   ├── MainPage.xaml
│   │   ├── MainPage.xaml.cs
│   │   ├── FileTreeView.xaml
│   │   ├── FileTreeView.xaml.cs
│   │   ├── PreviewView.xaml
│   │   ├── PreviewView.xaml.cs
│   │   └── ExportDialog.xaml
│   │
│   ├── ViewModels/                     # MVVM ViewModels
│   │   ├── MainViewModel.cs
│   │   ├── FileTreeViewModel.cs
│   │   ├── PreviewViewModel.cs
│   │   └── ExportViewModel.cs
│   │
│   ├── Services/                       # 業務邏輯服務
│   │   ├── Interfaces/
│   │   │   ├── IFileSystemService.cs
│   │   │   ├── IMarkdownService.cs
│   │   │   └── IExportService.cs
│   │   ├── Platform/
│   │   │   └── IPlatformFileSystem.cs
│   │   ├── FileSystemService.cs
│   │   ├── MarkdownService.cs
│   │   └── ExportService.cs
│   │
│   ├── Services/Export/                # 匯出服務實作
│   │   ├── HtmlExporter.cs
│   │   ├── PdfExporter.cs
│   │   ├── DocxExporter.cs
│   │   └── OdfExporter.cs
│   │
│   ├── Models/                         # 資料模型
│   │   ├── FileNode.cs
│   │   ├── DriveInfo.cs
│   │   ├── ExportOptions.cs
│   │   ├── ExportFormat.cs
│   │   └── MarkdownMetadata.cs
│   │
│   ├── Messages/                       # Messenger 訊息
│   │   ├── FileSelectedMessage.cs
│   │   └── ContentChangedMessage.cs
│   │
│   ├── Extensions/                     # 擴充方法
│   │   ├── PlatformExtensions.cs
│   │   └── StringExtensions.cs
│   │
│   ├── Utilities/                      # 工具類別
│   │   ├── FileHelper.cs
│   │   └── PathHelper.cs
│   │
│   ├── Resources/                      # 資源檔案
│   │   ├── Styles/
│   │   │   ├── Colors.xaml
│   │   │   ├── Styles.xaml
│   │   │   └── Themes.xaml
│   │   ├── Fonts/
│   │   │   └── OpenSans-Regular.ttf
│   │   └── Images/
│   │       ├── folder.png
│   │       └── file.png
│   │
│   ├── MauiProgram.cs                  # 應用程式入口
│   ├── App.xaml
│   └── App.xaml.cs
│
├── MD_Viewer.Blazor/                   # Blazor 元件專案（可選）
│   ├── Components/
│   │   ├── MarkdownPreview.razor
│   │   ├── MarkdownEditor.razor
│   │   └── EditorToolbar.razor
│   ├── wwwroot/
│   │   ├── js/
│   │   │   ├── markdown-renderer.ts
│   │   │   ├── editor.ts
│   │   │   └── interop.ts
│   │   ├── css/
│   │   │   ├── markdown.css
│   │   │   └── editor.css
│   │   └── lib/
│   │       ├── marked/
│   │       ├── highlight.js/
│   │       └── katex/
│   └── _Imports.razor
│
├── MD_Viewer.Core/                     # 共享核心邏輯（可選）
│   ├── Constants/
│   │   └── AppConstants.cs
│   ├── Enums/
│   │   ├── FileNodeType.cs
│   │   └── ViewMode.cs
│   └── Helpers/
│       └── ValidationHelper.cs
│
├── MD_Viewer.Tests/                    # 單元測試專案
│   ├── Services/
│   │   ├── FileSystemServiceTests.cs
│   │   ├── MarkdownServiceTests.cs
│   │   └── ExportServiceTests.cs
│   ├── ViewModels/
│   │   ├── MainViewModelTests.cs
│   │   └── FileTreeViewModelTests.cs
│   └── Mocks/
│       └── MockPlatformFileSystem.cs
│
├── docs/                               # 文件目錄
│   ├── 技術分析報告.md
│   └── v1/
│       ├── 01_系統架構設計.md
│       ├── 02_介面與類別設計.md
│       ├── 03_MVVM結構設計.md
│       ├── 04_平台抽象層設計.md
│       └── 05_專案結構與命名規範.md
│
└── MD_Viewer.sln                       # 解決方案檔案
```

## 2. 命名空間規範

### 2.1 命名空間結構

```
MD_Viewer
├── MD_Viewer                           # 根命名空間
│   ├── Views                           # Views
│   ├── ViewModels                      # ViewModels
│   ├── Services                        # Services
│   │   ├── Interfaces                  # 服務介面
│   │   └── Platform                    # 平台抽象
│   ├── Models                          # 資料模型
│   ├── Messages                        # Messenger 訊息
│   ├── Extensions                      # 擴充方法
│   └── Utilities                       # 工具類別
│
├── MD_Viewer.Platforms                 # 平台特定實作
│   ├── Windows                         # Windows 平台
│   ├── MacCatalyst                     # macOS 平台
│   └── Android                         # Android 平台
│
└── MD_Viewer.Blazor                    # Blazor 元件
    └── Components                      # Blazor 元件
```

### 2.2 命名空間範例

```csharp
// Views
namespace MD_Viewer.Views;

// ViewModels
namespace MD_Viewer.ViewModels;

// Services
namespace MD_Viewer.Services;
namespace MD_Viewer.Services.Interfaces;
namespace MD_Viewer.Services.Platform;

// Models
namespace MD_Viewer.Models;

// Platform specific
#if WINDOWS
namespace MD_Viewer.Platforms.Windows;
#elif MACCATALYST
namespace MD_Viewer.Platforms.MacCatalyst;
#elif ANDROID
namespace MD_Viewer.Platforms.Android;
#endif
```

## 3. 命名規範

### 3.1 類別命名

- **介面**：以 `I` 開頭，使用 PascalCase
  ```csharp
  IFileSystemService
  IMarkdownService
  IPlatformFileSystem
  ```

- **類別**：使用 PascalCase，名詞
  ```csharp
  FileSystemService
  MainViewModel
  FileNode
  ```

- **抽象類別**：使用 PascalCase，可選以 `Base` 結尾
  ```csharp
  BaseExporter
  BaseViewModel
  ```

- **靜態類別**：使用 PascalCase，通常以 `Helper`、`Extensions`、`Constants` 結尾
  ```csharp
  FileHelper
  StringExtensions
  AppConstants
  ```

### 3.2 方法命名

- **公開方法**：使用 PascalCase，動詞開頭
  ```csharp
  public async Task<string> ReadFileAsync(string path)
  public void ToggleEditMode()
  public bool IsMarkdownFile(string path)
  ```

- **私有方法**：使用 PascalCase
  ```csharp
  private void InitializeAsync()
  private bool ValidatePath(string path)
  ```

- **非同步方法**：以 `Async` 結尾
  ```csharp
  public async Task LoadFileAsync()
  public async Task ExportAsync()
  ```

### 3.3 屬性命名

- 使用 PascalCase
  ```csharp
  public string CurrentFileContent { get; set; }
  public bool IsLoading { get; set; }
  public FileNode? CurrentFile { get; set; }
  ```

- **布林屬性**：使用 `Is`、`Has`、`Can` 前綴
  ```csharp
  public bool IsLoading { get; set; }
  public bool HasError { get; set; }
  public bool CanExport { get; set; }
  ```

### 3.4 欄位命名

- **私有欄位**：使用 `_` 前綴 + camelCase
  ```csharp
  private readonly IFileSystemService _fileSystemService;
  private string _currentFileContent = string.Empty;
  private bool _isLoading;
  ```

- **常數**：使用 PascalCase
  ```csharp
  public const int MaxFileSize = 10 * 1024 * 1024;
  public const string MarkdownExtension = ".md";
  ```

### 3.5 參數命名

- 使用 camelCase
  ```csharp
  public async Task ReadFileAsync(string filePath, CancellationToken cancellationToken = default)
  public void UpdatePreview(string markdownContent)
  ```

### 3.6 區域變數命名

- 使用 camelCase
  ```csharp
  var fileContent = await ReadFileAsync(path);
  var isMarkdown = IsMarkdownFile(filePath);
  ```

### 3.7 列舉命名

- **列舉類型**：使用 PascalCase，單數形式
  ```csharp
  public enum FileNodeType
  {
      Directory,
      File
  }
  ```

- **列舉值**：使用 PascalCase
  ```csharp
  public enum ViewMode
  {
      Preview,
      Edit
  }
  ```

### 3.8 事件命名

- 使用 PascalCase，以 `EventHandler` 結尾或使用 `EventHandler<T>`
  ```csharp
  public event EventHandler<FileSelectedEventArgs>? FileSelected;
  public event EventHandler? LoadingChanged;
  ```

## 4. 檔案命名規範

### 4.1 檔案與類別對應

- 一個檔案一個類別（介面、列舉等）
- 檔案名稱與類別名稱一致
- 使用 PascalCase

```
FileSystemService.cs      → class FileSystemService
IFileSystemService.cs     → interface IFileSystemService
FileNode.cs               → class FileNode
ViewMode.cs               → enum ViewMode
```

### 4.2 XAML 檔案

- View 檔案：`{ViewName}.xaml` 和 `{ViewName}.xaml.cs`
  ```
  MainPage.xaml
  MainPage.xaml.cs
  FileTreeView.xaml
  FileTreeView.xaml.cs
  ```

### 4.3 資源檔案

- 樣式檔案：`{Purpose}.xaml`
  ```
  Styles.xaml
  Colors.xaml
  Themes.xaml
  ```

- 圖片檔案：使用小寫 + 連字號
  ```
  folder-icon.png
  file-icon.png
  edit-button.png
  ```

## 5. 程式碼組織規範

### 5.1 類別成員順序

```csharp
public class ExampleClass
{
    // 1. 常數
    private const int MaxSize = 100;

    // 2. 欄位
    private readonly IService _service;
    private string _field;

    // 3. 屬性
    public string Property { get; set; }

    // 4. 建構函式
    public ExampleClass(IService service)
    {
        _service = service;
    }

    // 5. 公開方法
    public void PublicMethod() { }

    // 6. 受保護方法
    protected void ProtectedMethod() { }

    // 7. 私有方法
    private void PrivateMethod() { }

    // 8. 事件
    public event EventHandler? SomethingHappened;
}
```

### 5.2 using 語句順序

```csharp
// 1. System 命名空間
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

// 2. 第三方套件
using Markdig;
using CommunityToolkit.Mvvm.ComponentModel;

// 3. 專案命名空間
using MD_Viewer.Models;
using MD_Viewer.Services;
```

### 5.3 XML 註解規範

```csharp
/// <summary>
/// 檔案系統服務，提供跨平台檔案操作功能
/// </summary>
public interface IFileSystemService
{
    /// <summary>
    /// 讀取檔案內容
    /// </summary>
    /// <param name="filePath">檔案路徑</param>
    /// <param name="cancellationToken">取消令牌</param>
    /// <returns>檔案內容</returns>
    /// <exception cref="FileNotFoundException">檔案不存在時拋出</exception>
    Task<string> ReadFileAsync(string filePath, CancellationToken cancellationToken = default);
}
```

## 6. 專案檔案規範

### 6.1 .csproj 檔案組織

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <!-- 基本屬性 -->
  </PropertyGroup>

  <ItemGroup>
    <!-- 套件參考 -->
  </ItemGroup>

  <ItemGroup>
    <!-- 專案參考 -->
  </ItemGroup>

  <ItemGroup>
    <!-- 資源檔案 -->
  </ItemGroup>
</Project>
```

### 6.2 目錄結構標記

使用 `.editorconfig` 或 `Directory.Build.props` 統一設定：

```xml
<!-- Directory.Build.props -->
<Project>
  <PropertyGroup>
    <RootNamespace>MD_Viewer</RootNamespace>
    <Nullable>enable</Nullable>
    <LangVersion>latest</LangVersion>
  </PropertyGroup>
</Project>
```

## 7. 版本控制規範

### 7.1 .gitignore

```
# Build results
[Dd]ebug/
[Rr]elease/
[Bb]in/
[Oo]bj/

# Visual Studio
.vs/
*.user
*.suo

# NuGet
packages/
*.nupkg

# MAUI
*.app
*.ipa
*.apk
```

### 7.2 提交訊息規範

```
feat: 新增檔案瀏覽功能
fix: 修復 Android 檔案存取問題
docs: 更新架構設計文件
refactor: 重構 FileSystemService
test: 新增 MarkdownService 單元測試
```

## 8. 註解規範

### 8.1 程式碼註解

- 複雜邏輯必須註解
- 公開 API 必須有 XML 註解
- 使用中文註解（專案要求）

```csharp
/// <summary>
/// 讀取目錄結構
/// </summary>
public async Task<List<FileNode>> ReadDirectoryAsync(string path)
{
    // 檢查路徑有效性
    if (string.IsNullOrEmpty(path))
        throw new ArgumentException("路徑不能為空", nameof(path));

    // 遞迴讀取目錄
    var nodes = new List<FileNode>();
    // ... 實作邏輯
}
```

### 8.2 TODO 註解

```csharp
// TODO: 實作檔案變更監聽功能
// FIXME: Android SAF 權限處理需要改進
// HACK: 暫時使用同步方法，後續改為非同步
```

