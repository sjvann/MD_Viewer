# 功能差異分析報告

## 1. 預覽功能差異

### 現有實作（MAUI 原生）
**位置：** `MD_Viewer/Views/PreviewView.xaml` + `PreviewViewModel.cs`

**實作方式：**
- 使用 MAUI `WebView` 控制項
- `PreviewViewModel` 使用 `MarkdownService.RenderToHtml()` 將 Markdown 轉為 HTML
- HTML 透過 `HtmlWebViewSource` 顯示在 WebView 中
- 包含完整的 CSS 樣式（標題、列表、表格、程式碼區塊等）

**優點：**
- ✅ 已完整實作
- ✅ 使用 C# 端 Markdig 渲染（效能好）
- ✅ 包含完整的樣式

**缺點：**
- ❌ 無法使用 TypeScript 生態系統（highlight.js、KaTeX 等）
- ❌ 樣式修改需要在 C# 程式碼中

---

### Blazor 版本（目前狀態）
**位置：** `MD_Viewer.Blazor/Components/Pages/Viewer.razor`

**目前實作：**
```razor
<div class="markdown-preview">@ViewModel.CurrentFileContent</div>
```
- ❌ **僅顯示原始 Markdown 文字**，未渲染
- ❌ 沒有使用 `PreviewViewModel.RenderedHtml`
- ❌ 沒有實作 Markdown 渲染

**應該的實作：**
```razor
@if (ViewModel.PreviewViewModel != null)
{
    <div class="markdown-preview" 
         @ref="previewContainer"
         @bind:innerHTML="@ViewModel.PreviewViewModel.RenderedHtml" />
}
```

**差異總結：**
- **現有功能**：完整實作，使用 C# Markdig 渲染
- **Blazor 版本**：尚未實作，目前只顯示原始文字

---

## 2. 編輯功能差異

### 現有實作（MAUI 原生）
**位置：** `MD_Viewer/Views/EditView.xaml` + `EditViewModel.cs`

**實作方式：**
- 使用 MAUI `Editor` 控制項
- 基本文字編輯功能
- 支援即時預覽（透過 `EditViewModel` 的防抖機制）

**優點：**
- ✅ 已完整實作
- ✅ 即時預覽同步
- ✅ 原生控制項，效能好

**缺點：**
- ❌ 功能有限（無語法高亮、無自動完成）
- ❌ 無法整合 Monaco Editor 或 CodeMirror

---

### Blazor 版本（目前狀態）
**位置：** `MD_Viewer.Blazor/Components/Pages/Viewer.razor`

**目前實作：**
```razor
<textarea class="markdown-editor" @bind="ViewModel.CurrentFileContent"></textarea>
```
- ❌ **僅使用基本 `<textarea>`**，功能與 MAUI Editor 相同
- ❌ 沒有語法高亮
- ❌ 沒有整合 Monaco Editor 或 CodeMirror

**應該的實作（如果使用 Monaco Editor）：**
```razor
<div id="monaco-editor-container" style="width: 100%; height: 100%;"></div>
@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("initMonacoEditor", 
                "monaco-editor-container", 
                ViewModel.CurrentFileContent);
        }
    }
}
```

**差異總結：**
- **現有功能**：基本編輯器，已完整實作
- **Blazor 版本**：同樣是基本編輯器，但**有潛力整合高級編輯器**（Monaco Editor、CodeMirror）

---

## 3. 檔案樹遷移評估

### 現有實作（MAUI 原生）
**位置：** `MD_Viewer/Views/FileTreeView.xaml` + `FileTreeViewModel.cs`

**實作方式：**
- 使用 MAUI `CollectionView` + 自訂 `TreeViewItem`
- 原生控制項，效能優秀
- 已完整實作檔案樹功能

**優點：**
- ✅ 原生效能最佳
- ✅ 已完整實作
- ✅ 觸控體驗好（平板）

**缺點：**
- ❌ 樣式受限於平台原生樣式
- ❌ 跨平台樣式可能不一致

---

### Blazor 版本（如果遷移）
**潛在實作：**
```razor
<div class="file-tree">
    <Picker @bind-SelectedItem="@ViewModel.FileTreeViewModel.SelectedDrive" />
    <ul class="tree-view">
        @foreach (var node in ViewModel.FileTreeViewModel.FileTree)
        {
            <TreeViewItem Node="@node" />
        }
    </ul>
</div>
```

**優點：**
- ✅ CSS 樣式完全可控，更美觀
- ✅ 跨平台樣式一致
- ✅ 可以使用 CSS 動畫和過渡效果

**缺點：**
- ❌ 效能略低於原生（WebView 渲染）
- ❌ 需要重新實作樹狀結構

---

## 4. 建議方案

### 方案 A：保持現狀（推薦）
**預覽功能：**
- ✅ 保持使用 MAUI `PreviewView`（已完整實作）
- ✅ 或將 `PreviewViewModel.RenderedHtml` 綁定到 Blazor 組件

**編輯功能：**
- ✅ 保持使用 MAUI `EditView`（已完整實作）
- ✅ 或將 `EditViewModel.MarkdownContent` 綁定到 Blazor `<textarea>`

**檔案樹：**
- ✅ **保持使用 MAUI `FileTreeView`**（原生效能好，已完整實作）

**理由：**
- 現有功能已完整實作
- 原生效能更好
- 減少重複開發

---

### 方案 B：部分遷移到 Blazor
**預覽功能：**
- 在 Blazor 中顯示 `PreviewViewModel.RenderedHtml`（使用 `@bind:innerHTML`）

**編輯功能：**
- 保持 MAUI `EditView`（或遷移到 Blazor 基本編輯器）

**檔案樹：**
- **保持 MAUI `FileTreeView`**（效能關鍵，不建議遷移）

---

### 方案 C：完全遷移到 Blazor（不推薦）
**理由：**
- 檔案樹效能關鍵，原生更好
- 預覽功能已完整實作，無需重做
- 編輯功能基本即可，除非需要高級編輯器

---

## 5. 結論

### 建議：方案 A（保持現狀）

1. **檔案樹**：保持 MAUI 原生
   - 效能關鍵，原生更好
   - 已完整實作，無需重做

2. **預覽功能**：
   - 現有實作已完整
   - 如果要在 Blazor 中顯示，只需綁定 `PreviewViewModel.RenderedHtml`

3. **編輯功能**：
   - 現有實作已完整
   - 如果未來需要高級編輯器（Monaco Editor），再遷移到 Blazor

### 需要修正的部分

**Blazor Viewer.razor 中的預覽：**
- 目前：`<div>@ViewModel.CurrentFileContent</div>` ❌（顯示原始文字）
- 應該：綁定到 `PreviewViewModel.RenderedHtml` ✅

**Blazor Viewer.razor 中的編輯：**
- 目前：`<textarea @bind="ViewModel.CurrentFileContent">` ✅（基本功能可用）
- 未來：可整合 Monaco Editor（如果需要）

---

*分析日期：2025-11-13*

