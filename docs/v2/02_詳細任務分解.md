# 詳細任務分解 (WBS)

## Phase 1：專案初始化與基礎架構

### 1.1 專案建立與環境設定
**預估工時**：1-2 天  
**優先級**：P0 (最高)

#### 任務清單
- [x] **T1.1.1** 建立 .NET MAUI 解決方案
  - 建立 MD_Viewer.sln
  - 建立主專案 MD_Viewer
  - 設定目標框架 (.NET 9/10)
  - 設定目標平台 (Windows, macOS, Android)

- [x] **T1.1.2** 安裝必要 NuGet 套件
  - Microsoft.Maui.Controls
  - CommunityToolkit.Maui
  - CommunityToolkit.Mvvm
  - Markdig
  - Microsoft.AspNetCore.Components.WebView.Maui（因 .NET 10 preview 相容性問題暫時移除）

- [x] **T1.1.3** 建立專案結構
  - 建立資料夾結構（Views, ViewModels, Services, Models 等）
  - 建立命名空間結構
  - 設定 .editorconfig

- [x] **T1.1.4** 設定 TypeScript 環境
  - 建立 Blazor 專案（如採用）
  - 設定 npm 專案
  - 安裝 TypeScript 套件（marked, highlight.js, katex）

### 1.2 基礎架構實作
**預估工時**：2-3 天  
**優先級**：P0

#### 任務清單
- [x] **T1.2.1** 實作依賴注入設定
  - 設定 MauiProgram.cs
  - 註冊服務介面與實作
  - 註冊 ViewModels

- [x] **T1.2.2** 建立核心介面
  - IFileSystemService
  - IMarkdownService
  - IExportService
  - IPlatformFileSystem

- [x] **T1.2.3** 建立資料模型
  - FileNode
  - DriveInfo
  - ExportOptions
  - ExportFormat
  - MarkdownMetadata

- [x] **T1.2.4** 建立基礎 ViewModels
  - MainViewModel (基本結構)
  - FileTreeViewModel (基本結構)
  - PreviewViewModel (基本結構)

- [x] **T1.2.5** 建立基礎 Views
  - MainPage.xaml (基本佈局)
  - App.xaml (應用程式資源)

### 1.3 平台抽象層基礎
**預估工時**：1 天  
**優先級**：P0

#### 任務清單
- [x] **T1.3.1** 實作 Windows 平台服務
  - WindowsFileSystem (基本結構)
  - Windows 特定設定

- [x] **T1.3.2** 建立平台服務註冊機制
  - 條件編譯設定
  - 平台服務註冊

---

## Phase 2：核心功能開發 - MVP

### 2.1 檔案系統服務實作
**預估工時**：3-4 天  
**優先級**：P0

#### 任務清單
- [x] **T2.1.1** 實作 WindowsFileSystem
  - GetDrivesAsync()
  - ReadDirectoryAsync()
  - RequestDirectoryAccessAsync()
  - 錯誤處理

- [x] **T2.1.2** 實作 FileSystemService
  - 實作 IFileSystemService 介面
  - 整合 IPlatformFileSystem
  - 檔案過濾邏輯（Markdown 副檔名）
  - 遞迴目錄讀取（實作為非遞迴）

- [ ] **T2.1.3** 單元測試
  - FileSystemService 測試
  - WindowsFileSystem 測試（Mock）

### 2.2 檔案瀏覽 UI
**預估工時**：2-3 天  
**優先級**：P0

#### 任務清單
- [x] **T2.2.1** 實作 FileTreeView.xaml
  - 磁碟選擇器 UI
  - 目錄樹 UI (CollectionView)
  - 檔案節點樣式

- [x] **T2.2.2** 實作 FileTreeViewModel
  - 載入磁碟列表
  - 載入目錄結構
  - 節點展開/收合邏輯
  - 檔案選擇處理

- [x] **T2.2.3** 整合檔案選擇流程
  - 檔案選擇事件
  - Messenger 訊息傳遞
  - 與 MainViewModel 整合

### 2.3 Markdown 服務實作
**預估工時**：2 天  
**優先級**：P0

#### 任務清單
- [x] **T2.3.1** 實作 MarkdownService (C#)
  - 使用 Markdig 解析
  - RenderToHtml()
  - ValidateMarkdown()
  - ExtractMetadata()

- [x] **T2.3.2** 建立 TypeScript 渲染器
  - markdown-renderer.ts
  - 整合 marked.js
  - 整合 highlight.js
  - 整合 KaTeX

- [ ] **T2.3.3** 建立 Blazor 預覽元件
  - MarkdownPreview.razor
  - JavaScript Interop 設定
  - CSS 樣式
  - 註：此任務移至 Story 2.4 實作

### 2.4 預覽功能 UI
**預估工時**：2 天  
**優先級**：P0  
**Story**：2.4.story.md  
**狀態**：✅ 已完成

#### 任務清單
- [x] **T2.4.1** 實作 PreviewView
  - MAUI WebView 整合（替代 Blazor WebView）
  - 預覽面板佈局
  - 載入狀態和錯誤訊息顯示

- [x] **T2.4.2** 實作 PreviewViewModel
  - 更新預覽內容（UpdatePreview 方法）
  - 處理檔案載入
  - HTML 包裝和 CSS 樣式

- [x] **T2.4.3** 整合預覽流程
  - 檔案選擇 → 載入內容 → 渲染預覽
  - MainViewModel 整合
  - MainPage 整合
  - 錯誤處理
  - 載入狀態顯示

### 2.5 主視窗整合
**預估工時**：1-2 天  
**優先級**：P0  
**Story**：2.5.story.md  
**狀態**：✅ 已完成

#### 任務清單
- [x] **T2.5.1** 完成 MainPage 佈局
  - 左側檔案樹
  - 右側預覽區
  - 響應式設計

- [x] **T2.5.2** 完成 MainViewModel
  - 整合 FileTreeViewModel
  - 整合 PreviewViewModel
  - 檔案載入邏輯

- [x] **T2.5.3** MVP 功能測試
  - 端對端測試
  - 錯誤處理測試
  - 效能測試（大型檔案）

---

## Phase 3：進階功能開發

### 3.1 編輯功能
**預估工時**：3 天  
**優先級**：P1  
**Story**：3.1.story.md  
**狀態**：✅ 已完成

#### 任務清單
- [x] **T3.1.1** 實作編輯模式切換
  - MainViewModel.ToggleEditMode()
  - UI 模式切換邏輯

- [x] **T3.1.2** 建立編輯器元件
  - EditView.xaml（使用 MAUI Editor）
  - 編輯器設定
  - 註：暫時使用 MAUI Editor，後續可考慮整合 Monaco Editor

- [x] **T3.1.3** 實作雙欄編輯/預覽
  - 編輯區與預覽區並排
  - 響應式佈局（平板適配）

- [x] **T3.1.4** 實作即時同步
  - EditViewModel 內容變更事件處理
  - 預覽即時更新
  - 可選：防抖（debounce）機制

- [x] **T3.1.5** 檔案儲存功能
  - 儲存按鈕與命令
  - 檔案寫入邏輯
  - 儲存確認對話框

### 3.2 HTML 匯出功能
**預估工時**：0.5 天  
**優先級**：P1  
**Story**：3.2.story.md  
**狀態**：✅ 已完成

#### 任務清單
- [x] **T3.2.1** 實作 HtmlExporter
  - 建立 HTML 模板
  - 嵌入 CSS 樣式
  - 儲存 HTML 檔案

- [x] **T3.2.2** 整合匯出功能
  - ExportService 整合
  - 匯出對話框
  - 檔案選擇對話框

### 3.3 PDF 匯出功能
**預估工時**：3-4 天  
**優先級**：P1  
**Story**：3.3.story.md  
**狀態**：✅ 已完成

#### 任務清單
- [x] **T3.3.1** 安裝與設定 QuestPDF
  - 安裝 NuGet 套件
  - 學習 QuestPDF API

- [x] **T3.3.2** 實作 PdfExporter
  - HTML 到 PDF 轉換邏輯
  - 頁面設定（A4, Letter）
  - 樣式處理

- [x] **T3.3.3** PDF 樣式優化
  - 標題樣式
  - 程式碼區塊樣式
  - 表格樣式
  - 分頁處理

- [x] **T3.3.4** PDF 匯出測試
  - 各種 Markdown 元素測試
  - 大型文件測試
  - 樣式一致性測試

### 3.4 工具列與 UI 增強
**預估工時**：1-2 天  
**優先級**：P2  
**Story**：3.4.story.md  
**狀態**：✅ 已完成

#### 任務清單
- [x] **T3.4.1** 實作工具列
  - 編輯按鈕
  - 匯出按鈕
  - 設定按鈕（未來擴充）

- [x] **T3.4.2** UI 樣式優化
  - 主題樣式
  - 圖示資源
  - 動畫效果（可選）

---

## Phase 4：多平台適配與優化

### 4.1 macOS 適配
**預估工時**：2-3 天  
**優先級**：P1

#### 任務清單
- [ ] **T4.1.1** 實作 MacFileSystem
  - GetDrivesAsync() (常用目錄)
  - RequestDirectoryAccessAsync() (NSOpenPanel)
  - 沙盒權限處理

- [ ] **T4.1.2** macOS UI 適配
  - 平台特定樣式
  - 視窗大小與佈局
  - 選單列整合（可選）

- [ ] **T4.1.3** macOS 測試
  - 功能測試
  - 沙盒環境測試
  - App Store 上架準備檢查

### 4.2 Android 適配
**預估工時**：3-4 天  
**優先級**：P1

#### 任務清單
- [ ] **T4.2.1** 實作 AndroidFileSystem
  - GetDrivesAsync() (常用目錄)
  - RequestDirectoryAccessAsync() (SAF)
  - SAF 權限處理

- [ ] **T4.2.2** Android UI 適配
  - 行動裝置佈局
  - 平板佈局
  - Material Design 樣式

- [ ] **T4.2.3** Android 權限處理
  - 權限請求流程
  - SAF 整合
  - 檔案存取權限管理

- [ ] **T4.2.4** Android 測試
  - 功能測試
  - 不同 Android 版本測試
  - Google Play 上架準備檢查

### 4.3 UI 優化與響應式設計
**預估工時**：1-2 天  
**優先級**：P2

#### 任務清單
- [ ] **T4.3.1** 響應式佈局優化
  - 桌面版佈局
  - 平板版佈局
  - 手機版佈局

- [ ] **T4.3.2** 效能優化
  - 大型檔案處理
  - 虛擬滾動（如需要）
  - 快取機制

- [ ] **T4.3.3** 無障礙功能
  - 鍵盤導航
  - 螢幕閱讀器支援（可選）

### 4.4 測試與除錯
**預估工時**：2 天  
**優先級**：P0  
**Story**：4.4.story.md  
**狀態**：🔄 進行中（QA 主導）

#### 任務清單
- [ ] **T4.4.1** 整合測試
  - 各平台功能測試
  - 跨平台一致性測試

- [ ] **T4.4.2** 效能測試
  - 大型檔案測試
  - 記憶體使用測試
  - 啟動時間測試

- [ ] **T4.4.3** 錯誤處理測試
  - 異常情況測試
  - 錯誤訊息測試

- [ ] **T4.4.4** 使用者體驗測試
  - 操作流程測試
  - UI/UX 改進建議

---

## 可選功能（未來擴充）

### 5.1 DOCX 匯出
**預估工時**：4-5 天  
**優先級**：P3

### 5.2 ODF 匯出
**預估工時**：4-5 天  
**優先級**：P3

### 5.3 進階編輯功能
**預估工時**：3-5 天  
**優先級**：P3
- 語法自動完成
- 快捷鍵支援
- 多檔案編輯

### 5.4 主題系統
**預估工時**：2 天  
**優先級**：P3
- 亮色/暗色主題
- 自訂主題

---

## 任務優先級說明

- **P0 (最高)**：核心功能，必須完成
- **P1 (高)**：重要功能，建議完成
- **P2 (中)**：增強功能，有時間再完成
- **P3 (低)**：可選功能，未來擴充

## 任務狀態說明

- ⏳ **待開始**：尚未開始
- 🔄 **進行中**：正在進行
- ✅ **已完成**：已完成
- ⚠️ **阻塞**：遇到問題，需要協助
- ❌ **取消**：已取消

